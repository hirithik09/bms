{% extends "base.html" %} {% block title %}Book{% endblock %} {% block content
%}

<h3>Book Collection</h3>

<!-- Dependencies -->
<script src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/jquery.validate.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/jsdelivr.bootstrap.js') }}"></script>
<script src="{{ url_for('static', filename='js/datatable.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/book.js') }}"></script>
<script src="{{ url_for('static', filename='js/sweetalert.js') }}"></script>

<!-- Bootstrap Toast Container -->
<div
  aria-live="polite"
  aria-atomic="true"
  class="position-fixed top-0 end-0 p-3"
  style="z-index: 1080"
>
  <div id="toastContainer"></div>
</div>

<p class="text-end">
  <a href="#" class="btn btn-primary" id="add_record">Add Book</a>
</p>

<table
  id="bookTable"
  class="table table-striped table-bordered"
  style="width: 100%"
>
  <thead>
    <tr>
      <th>Id</th>
      <th>Image</th>
      <th>Book</th>
      <th>Author</th>
      <th>Genre</th>
      <th>ISBN</th>
      <th>Stock</th>
      <th>Created At</th>
      <th>Updated At</th>
      <th>Status</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody>
    {% for book in books %}
    <tr data-id="{{ book.id }}">
      <td>{{ book.id }}</td>
      <td>
        {% if book.image %}
        <img
          src="{{ url_for('static', filename='uploads/' + book.image) }}"
          alt="Book Image"
          width="50"
          style="border-radius: 10px"
        />
        {% else %} No Image {% endif %}
      </td>
      <td>{{ book.book_name }}</td>
      <td>{{ book.author_name }}</td>
      <td>{{ book.book_category}}</td>
      <td>{{ book.isbn }}</td>
      <td>{{ book.stock }}</td>
      <td>{{ book.created_date }}</td>
      <td>{{ book.updated_date }}</td>
      <td>
        <div class="form-check form-switch">
          {% set status_val = book.status if book.status is not none else 1 %}
          <input class="form-check-input status-toggle" type="checkbox"
          role="switch" {% if book.status == 1 or book.status == '1' %} checked
          {% endif %} />
        </div>
      </td>
      <td>
        <button class="btn btn-sm btn-primary edit-btn">Edit</button>
        <button class="btn btn-sm btn-danger delete-btn">Delete</button>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<!-- Book Modal -->
<div
  class="modal fade"
  id="bookModal"
  tabindex="-1"
  aria-labelledby="bookModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <form id="bookForm" enctype="multipart/form-data">
        <div class="modal-header">
          <h5 class="modal-title" id="bookModalLabel">Add Book</h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="bookId" name="bookId" />

          <div class="mb-3">
            <label for="bookNameInput" class="form-label">Book Name</label>
            <input
              type="text"
              class="form-control"
              id="bookNameInput"
              name="book_name"
              required
            />
          </div>

          <div class="mb-3">
            <label for="isbnInput" class="form-label"
              >ISBN (Auto-generated)</label
            >
            <input
              type="text"
              class="form-control"
              id="isbnInput"
              name="isbn"
              readonly
            />
          </div>

          <div class="mb-3">
            <label for="authorSelect" class="form-label">Author</label>
            <select
              class="form-select"
              id="authorSelect"
              name="author_id"
              required
            >
              <option value="" disabled selected>Select Author</option>
              {% for author in authors %}
              <option value="{{ author.id }}">{{ author.author_name }}</option>
              {% endfor %}
            </select>
          </div>

          <div class="mb-3">
            <label for="genreSelect" class="form-label">Genre</label>
            <select
              class="form-select"
              id="genreSelect"
              name="category_id"
              required
            >
              <option value="" disabled selected>Select Genre</option>
              {% for category in categories %}
              <option value="{{ category.id }}">
                {{ category.book_category }}
              </option>
              {% endfor %}
            </select>
          </div>

          <div class="mb-3">
            <label for="stockInput" class="form-label">Stock</label>
            <input
              type="number"
              class="form-control"
              id="stockInput"
              name="stock"
              min="0"
              required
            />
          </div>

          <div class="mb-3">
            <label for="imageInput" class="form-label">Book Image</label>
            <input
              type="file"
              class="form-control"
              id="imageInput"
              name="image"
              accept="image/*"
            />
            <div id="previewImage" class="mt-2"></div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Save</button>
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Cancel
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Add Select2 -->
<link
  href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css"
  rel="stylesheet"
/>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<style>
  .is-invalid {
    border-color: #dc3545 !important;
    box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
  }
</style>

{% endblock %}
